<div class="row">
  <div class="col-md-12">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Novo Pedido</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form [formGroup]="orderForm" (ngSubmit)="onSubmit()" class="order-form">
          <!-- Informações do Pedido -->
          <div class="form-section">
            <h3>Informações do Pedido</h3>
            
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Número do Pedido</mat-label>
              <input matInput formControlName="orderNumber" placeholder="Ex: PED-2024-001" />
              <mat-error>{{ getErrorMessage('orderNumber') }}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Descrição</mat-label>
              <textarea
                matInput
                formControlName="description"
                rows="3"
                placeholder="Descreva os itens do pedido"
              ></textarea>
              <mat-error>{{ getErrorMessage('description') }}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Valor</mat-label>
              <input
                matInput
                type="number"
                formControlName="value"
                placeholder="0.00"
                step="0.01"
              />
              <span matTextPrefix>R$&nbsp;</span>
              <mat-error>{{ getErrorMessage('value') }}</mat-error>
            </mat-form-field>
          </div>

          <!-- Endereço de Entrega -->
          <div class="form-section" formGroupName="deliveryAddress">
            <h3>Endereço de Entrega</h3>

            <div class="cep-container">
              <mat-form-field appearance="outline" class="cep-field">
                <mat-label>CEP</mat-label>
                <input
                  matInput
                  formControlName="cep"
                  placeholder="12345-678"
                  maxlength="9"
                />
                <mat-error>{{ getErrorMessage('deliveryAddress.cep') }}</mat-error>
              </mat-form-field>
              @if (isLoadingCep) {
                <mat-spinner diameter="24" class="cep-spinner"></mat-spinner>
              }
            </div>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Rua</mat-label>
              <input matInput formControlName="street" placeholder="Nome da rua" />
              <mat-error>{{ getErrorMessage('deliveryAddress.street') }}</mat-error>
            </mat-form-field>

            <div class="row-fields">
              <mat-form-field appearance="outline" class="number-field">
                <mat-label>Número</mat-label>
                <input matInput id="number" formControlName="number" placeholder="123" />
                <mat-error>{{ getErrorMessage('deliveryAddress.number') }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="neighborhood-field">
                <mat-label>Bairro</mat-label>
                <input matInput formControlName="neighborhood" placeholder="Nome do bairro" />
                <mat-error>{{ getErrorMessage('deliveryAddress.neighborhood') }}</mat-error>
              </mat-form-field>
            </div>

            <div class="row-fields">
              <mat-form-field appearance="outline" class="city-field">
                <mat-label>Cidade</mat-label>
                <input matInput formControlName="city" placeholder="Nome da cidade" />
                <mat-error>{{ getErrorMessage('deliveryAddress.city') }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="state-field">
                <mat-label>Estado</mat-label>
                <input
                  matInput
                  formControlName="state"
                  placeholder="UF"
                  maxlength="2"
                  style="text-transform: uppercase"
                />
                <mat-error>{{ getErrorMessage('deliveryAddress.state') }}</mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- Botões -->
          <div class="form-actions">
            <button
              mat-raised-button
              type="button"
              routerLink="/dashboard"
              [disabled]="isSubmitting"
            >
              Cancelar
            </button>
            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="isSubmitting"
            >
              @if (isSubmitting) {
                <mat-spinner diameter="20" style="display: inline-block; margin-right: 8px"></mat-spinner>
              }
              {{ isSubmitting ? 'Criando...' : 'Criar Pedido' }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>
</div>
